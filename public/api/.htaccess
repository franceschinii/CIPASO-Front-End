# =================================================================
# Configuração .htaccess para API PHP - Memorial CIPASO
# =================================================================

# Habilitar RewriteEngine
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Forçar HTTPS em produção (comentar em desenvolvimento local)
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# =================================================================
# SEGURANÇA
# =================================================================

# Prevenir listagem de diretórios
Options -Indexes

# Bloquear acesso a arquivos sensíveis
<FilesMatch "^(config\.php|\.htaccess|\.env)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Headers de segurança
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # CSP (ajustar conforme necessário)
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:;"
</IfModule>

# =================================================================
# PERFORMANCE
# =================================================================

# Habilitar compressão GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
</IfModule>

# Cache de respostas JSON (1 hora)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType application/json "access plus 1 hour"
</IfModule>

# =================================================================
# LIMITES DE UPLOAD (ajustar conforme necessário)
# =================================================================

php_value upload_max_filesize 50M
php_value post_max_size 50M
php_value memory_limit 256M
php_value max_execution_time 300

# =================================================================
# TRATAMENTO DE ERROS
# =================================================================

# Não expor versão do PHP
php_flag expose_php off

# Logs de erro (desativar display em produção)
php_flag display_errors off
php_flag log_errors on
php_value error_log /home/seuusuario/logs/php_errors.log

# =================================================================
# CHARSET
# =================================================================

AddDefaultCharset UTF-8
